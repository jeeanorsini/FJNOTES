<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FJNOTES Pro Avan√ßado</title>
<!-- Styles copiados e ajustados para melhor visual e funcionalidade -->
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

  /* Reset e base */
  * { box-sizing: border-box; }
  body {
    margin: 0; padding: 0;
    font-family: 'Montserrat', sans-serif;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  body.dark {
    background-color: #121212; color: #FFC107;
  }
  body.light {
    background-color: #fdf6e3; color: #b58900;
  }

  header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 1rem 2rem;
    background-color: inherit;
    border-bottom: 2px solid currentColor;
  }
  h1 {
    margin: 0; font-weight: 700; font-size: 1.8rem;
    user-select: text;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  button {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    border: 2px solid currentColor;
    background: transparent;
    color: inherit;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.95rem;
    transition: background-color 0.25s ease, color 0.25s ease;
    user-select: none;
  }
  button:hover {
    background-color: currentColor;
    color: var(--button-hover-text, #121212);
  }
  main {
    display: flex;
    padding: 1rem 2rem;
    gap: 1rem;
    height: calc(100vh - 80px);
    box-sizing: border-box;
  }
  /* Colunas */
  #telaPrincipal {
    flex: 1;
    display: flex;
    overflow-x: auto;
    gap: 1rem;
    background-color: var(--panel-bg);
    border-radius: 12px;
    padding: 1rem;
    max-height: 100%;
  }
  body.dark #telaPrincipal {
    --panel-bg: #1e1e1e;
  }
  body.light #telaPrincipal {
    --panel-bg: #eee8d5;
    color: #b58900;
  }
  .coluna {
    flex-shrink: 0;
    width: 300px;
    background-color: var(--col-bg);
    border-radius: 12px;
    border: 2px solid currentColor;
    box-shadow: 0 0 12px #ffc10744 inset;
    padding: 1rem;
    display: flex;
    flex-direction: column;
  }
  body.dark .coluna {
    --col-bg: #2a2a2a;
  }
  body.light .coluna {
    --col-bg: #f7f1db;
  }
  .coluna h2 {
    margin: 0 0 1rem 0;
    font-weight: 900;
    letter-spacing: 1px;
    font-size: 1.3rem;
  }
  .btn-primary {
    background-color: #ffc107;
    color: #121212;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    cursor: pointer;
    font-weight: 900;
    font-size: 1rem;
    margin-bottom: 1rem;
  }
  .btn-primary:hover {
    background-color: #ffca28cc;
  }
  /* Cart√µes */
  .cartao {
    flex-shrink: 0;
    background-color: var(--card-bg);
    color: inherit;
    border-radius: 12px;
    box-shadow: 0 0 10px #ffc10755;
    padding: 0.75rem 1rem;
    margin-bottom: 0.75rem;
    cursor: grab;
    border: 1.5px solid currentColor;
    user-select: text;
    display: flex;
    flex-direction: column;
  }
  body.dark .cartao {
    --card-bg: #333;
  }
  body.light .cartao {
    --card-bg: #fff8dc;
  }
  .cartao textarea {
    all: unset;
    width: 100%;
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    font-size: 1rem;
    white-space: pre-wrap;
    word-break: break-word;
    min-height: 40px;
    resize: vertical;
    color: inherit;
  }
  /* Mapa Mental */
  #mapaContainer {
    position: relative;
    background-color: var(--map-bg);
    border-radius: 12px;
    border: 2px solid currentColor;
    flex: 1;
    overflow: hidden;
    max-height: 100%;
    cursor: grab;
  }
  body.dark #mapaContainer {
    --map-bg: #1e1e1e;
  }
  body.light #mapaContainer {
    --map-bg: #fff8dc;
    color: #b58900;
  }
  #svgConexoes {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    stroke-width: 2.5;
    fill: none;
    z-index: 0;
  }
  #mapaMental {
    position: relative;
    min-height: 100%;
    width: 100%;
    overflow: visible;
    touch-action: none;
  }
  .topico {
    position: absolute;
    background-color: var(--topico-bg);
    border-radius: 12px;
    padding: 12px 16px;
    min-width: 160px;
    max-width: 250px;
    border: 2px solid currentColor;
    box-shadow: 0 0 10px #ffc10755;
    font-weight: 700;
    font-size: 1.1rem;
    word-break: break-word;
    cursor: grab;
    user-select: text;
    transition: box-shadow 0.3s ease, transform 0.3s ease;
  }
  body.dark .topico {
    --topico-bg: #222;
  }
  body.light .topico {
    --topico-bg: #ffe082;
  }
  .topico:hover {
    box-shadow: 0 0 25px #ffca2855;
    transform: scale(1.05);
    z-index: 100;
  }
  .topico input {
    all: unset;
    width: 100%;
    font-weight: 700;
    font-size: 1rem;
    background-color: transparent;
    color: inherit;
    outline: none;
    font-family: 'Montserrat', sans-serif;
    text-align: center;
  }
  /* Bot√µes de conex√£o e a√ß√µes */
  .conexaoBtn {
    margin-top: 6px;
    padding: 6px 12px;
    font-size: 0.9rem;
    border: 1px solid currentColor;
    border-radius: 8px;
    background: transparent;
    cursor: pointer;
  }
  /* Sele√ß√£o */
  .selecionado {
    outline: 3px solid #fff176;
    box-shadow: 0 0 20px #fff176;
    z-index: 101 !important;
  }

  /* Toast */
  #toast {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    background-color: #ffc107dd;
    color: #121212;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    font-weight: 700;
    font-family: 'Montserrat', sans-serif;
    box-shadow: 0 0 15px #ffc107aa;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 9999;
  }
  #toast.show {
    opacity: 1;
    pointer-events: auto;
  }
</style>
</head>
<body class="dark">
<header>
  <h1>FJNOTES Pro</h1>
  <input type="search" id="searchInput" placeholder="Buscar cart√µes ou t√≥picos..." oninput="filtrarConteudo()" />
  <div class="controls">
    <button onclick="undoEstado()" id="btnUndo" disabled title="Desfazer (Ctrl+Z)">‚Ü∂ Undo</button>
    <button onclick="redoEstado()" id="btnRedo" disabled title="Refazer (Ctrl+Y)">‚Ü∑ Redo</button>
    <button onclick="toggleTema()" title="Alternar tema claro/escuro">üåì Tema</button>
  </div>
</header>
<main>
  <div id="telaPrincipal" aria-label="Quadro de colunas" role="region"></div>
  <div id="mapaContainer" aria-label="Mapa mental" style="display:none;" role="region">
    <svg id="svgConexoes" preserveAspectRatio="none"></svg>
    <div id="mapaMental"></div>
  </div>
</main>

<div id="botoesBarras" role="toolbar" aria-label="Ferramentas" style="margin:1rem; display:flex; gap:0.5rem; justify-content:center;">
  <button onclick="adicionarColuna()">Adicionar Coluna</button>
  <button onclick="mostrarTabuleiro()">Mostrar Quadro</button>
  <button onclick="mostrarMapaMental()">Mostrar Mapa Mental</button>
  <button onclick="exportarDados()">Exportar Dados</button>
  <button onclick="mostrarImportar()">Importar Dados</button>
  <button onclick="selecionarParaConectar()">Selecionar T√≥picos</button>
  <button onclick="conectarSelecionados()">Conectar Selecionados</button>
  <button onclick="limparSelecao()">Limpar Sele√ß√£o</button>
  <button onclick="criarTopico()">Adicionar T√≥pico</button>
  <button onclick="limparMapa()">Limpar Mapa</button>
</div>
<input type="file" id="arquivoImportar" style="display:none" onchange="importarDados(event)" />

<div id="toast"></div>

<script>
  // Vari√°veis principais
  let colunas = [];
  let mapaMental = [];
  let modoMapa = false;
  let selecao = [];

  let historico = [];
  let indexHistorico = -1;
  const MAX_HIST = 50;

  // Fun√ß√£o toast
  function toast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
  }

  // Gerenciamento de hist√≥rico (Undo/Redo)
  function salvarEstado() {
    if(indexHistorico < historico.length -1) {
      historico.splice(indexHistorico+1);
    }
    const snapshot = JSON.stringify({colunas, mapaMental});
    historico.push(snapshot);
    if(historico.length > MAX_HIST) {
      historico.shift();
    } else {
      indexHistorico++;
    }
    atualizarBotoesUndoRedo();
    salvarDadosLocal();
  }
  function desfazer() {
    if(indexHistorico > 0) {
      indexHistorico--;
      carregarEstadoHistorico();
    }
  }
  function refazer() {
    if(indexHistorico < historico.length-1) {
      indexHistorico++;
      carregarEstadoHistorico();
    }
  }
  function carregarEstadoHistorico() {
    try {
      const snap = historico[indexHistorico];
      if(snap) {
        const estado = JSON.parse(snap);
        colunas = estado.colunas || [];
        mapaMental = estado.mapaMental || [];
        selecao = [];
        renderizarColunas();
        renderizarMapaMental();
        salvarDadosLocal();
        toast('A√ß√µes restauradas');
        atualizarBotoesUndoRedo();
      }
    } catch {
      toast('Erro ao restaurar estado');
    }
  }
  function atualizarBotoesUndoRedo() {
    document.getElementById('btnUndo').disabled = indexHistorico <= 0;
    document.getElementById('btnRedo').disabled = indexHistorico >= historico.length-1 || indexHistorico < 0;
  }
  function undoEstado() { desfazer(); }
  function redoEstado() { refazer(); }

  // Tema
  function toggleTema() {
    document.body.classList.toggle('dark');
    document.body.classList.toggle('light');
    localStorage.setItem('tema', document.body.classList.contains('dark') ? 'dark' : 'light');
  }
  function aplicarTemaSalvo() {
    const tema = localStorage.getItem('tema') || 'dark';
    document.body.classList.toggle('dark', tema==='dark');
    document.body.classList.toggle('light', tema==='light');
  }

  // Persist√™ncia local
  function salvarDadosLocal() {
    localStorage.setItem('dadosGerenciador', JSON.stringify({colunas, mapaMental}));
  }
  function carregarDadosLocal() {
    const dados = localStorage.getItem('dadosGerenciador');
    if(dados) {
      try {
        const obj = JSON.parse(dados);
        colunas = obj.colunas || [];
        mapaMental = obj.mapaMental || [];
      } catch {
        colunas = [];
        mapaMental = [];
      }
    }
  }
  carregarDadosLocal();
  aplicarTemaSalvo();

  // ==== CRUD colunas ====
  function adicionarColuna() {
    let nome = prompt('Nome da nova coluna:', 'Nova coluna');
    if(!nome) return;
    colunas.push({ id: Date.now(), nome, cartoes: [] });
    salvarEstado();
    renderizarColunas();
  }

  function renderizarColunas() {
    const container = document.getElementById('telaPrincipal');
    container.innerHTML = '';
    colunas.forEach(col => {
      const colDiv = document.createElement('div');
      colDiv.className = 'coluna';
      colDiv.setAttribute('data-id', col.id);
      // T√≠tulo
      const h2 = document.createElement('h2');
      h2.textContent = col.nome;
      colDiv.appendChild(h2);
      // Bot√£o para adicionar cart√£o
      const btnAddCard = document.createElement('button');
      btnAddCard.className = 'btn-primary';
      btnAddCard.textContent = 'Adicionar Cart√£o';
      btnAddCard.onclick = () => {
        const texto = prompt('Conte√∫do do cart√£o:', '');
        if(!texto) return;
        col.cartoes.push({ id: Date.now(), texto, tags: [] });
        salvarEstado();
        renderizarColunas();
      };
      colDiv.appendChild(btnAddCard);
      // Cart√µes
      col.cartoes.forEach((cartao, i) => {
        const cartaoDiv = document.createElement('div');
        cartaoDiv.className = 'cartao';
        cartaoDiv.setAttribute('data-colid', col.id);
        cartaoDiv.setAttribute('data-index', i);
        cartaoDiv.draggable = true;
        cartaoDiv.ondragstart = e => {
          e.dataTransfer.setData('cartao', JSON.stringify({ colId: col.id, index: i }));
        };

        // Texto
        const ta = document.createElement('textarea');
        ta.value = cartao.texto;
        ta.oninput = () => {
          cartao.texto = ta.value;
          salvarEstado();
        };
        cartaoDiv.appendChild(ta);

        // Tags
        const tagsContainer = document.createElement('div');
        tagsContainer.className = 'tag-list';
        (cartao.tags || []).forEach(t => {
          const spanTag = document.createElement('span');
          spanTag.className = 'tag';
          spanTag.textContent = t;
          spanTag.title = 'Clique para remover tag';
          spanTag.onclick = () => {
            cartao.tags = cartao.tags.filter(tag => tag !== t);
            salvarEstado();
            renderizarColunas();
            toast(`Tag "${t}" removida`);
          };
          tagsContainer.appendChild(spanTag);
        });
        cartaoDiv.appendChild(tagsContainer);
        // Bot√£o add tag
        const btnAddTag = document.createElement('button');
        btnAddTag.textContent = '+Tag';
        btnAddTag.title = 'Adicionar tag';
        btnAddTag.onclick = e => {
          e.stopPropagation();
          const novaTag = prompt('Nome da tag:');
          if(novaTag && !cartao.tags.includes(novaTag.trim())) {
            cartao.tags.push(novaTag.trim());
            salvarEstado();
            renderizarColunas();
            toast(`Tag "${novaTag.trim()}" adicionada`);
          }
        };
        cartaoDiv.appendChild(btnAddTag);

        // Bot√£o excluir cart√£o
        const btnExcluir = document.createElement('button');
        btnExcluir.textContent = '√ó';
        btnExcluir.title = 'Excluir cart√£o';
        btnExcluir.onclick = e => {
          e.stopPropagation();
          if(confirm('Excluir este cart√£o?')) {
            col.cartoes.splice(i,1);
            salvarEstado();
            renderizarColunas();
          }
        };
        cartaoDiv.appendChild(btnExcluir);

        // Drag & drop
        colDiv.ondragover = e => e.preventDefault();
        colDiv.ondrop = e => {
          const data = JSON.parse(e.dataTransfer.getData('cartao'));
          const origCol = colunas.find(c => c.id === data.colId);
          if(origCol) {
            const cartao = origCol.cartoes.splice(data.index,1)[0];
            col.cartoes.push(cartao);
            salvarEstado();
            renderizarColunas();
          }
        };

        // Adicionar ao container
        container.appendChild(colDiv);
        colDiv.appendChild(cartaoDiv);
      });
    });
  }

  // ==== Mapa mental ====
  // Cria novo t√≥pico
  function criarTopico() {
    const texto = prompt('Texto do t√≥pico:', 'Novo t√≥pico');
    if(!texto) return;
    const novoTopo = {
      id: Date.now(),
      texto,
      conexoes: [],
      pos: { x: 200 + Math.random()*300, y: 150 + Math.random()*250 },
      tags: []
    };
    mapaMental.push(novoTopo);
    salvarEstado();
    renderizarMapaMental();
  }

  // Limpa mapa
  function limparMapa() {
    if(confirm('Deseja limpar o mapa mental?')){
      mapaMental = [];
      salvarEstado();
      renderizarMapaMental();
    }
  }

  // Vari√°veis para drag
  let dragTopo = null;
  let offsetX = 0;
  let offsetY = 0;

  // Renderiza mapa mental
  function renderizarMapaMental() {
    const container = document.getElementById('mapaMental');
    const svg = document.getElementById('svgConexoes');
    container.innerHTML = '';
    svg.innerHTML = '';

    // Renderiza t√≥picos
    mapaMental.forEach(tp => {
      const el = document.createElement('div');
      el.className = 'topico';
      el.setAttribute('data-id', tp.id);
      el.style.left = tp.pos.x + 'px';
      el.style.top = tp.pos.y + 'px';
      el.style.transform = `scale(${zoomLevel})`;
      if(selecao.includes(tp.id)) el.classList.add('selecionado');

      // Texto edit√°vel
      const input = document.createElement('input');
      input.value = tp.texto;
      input.oninput = () => {
        tp.texto = input.value;
        salvarEstado();
      };
      el.appendChild(input);

      // Tags
      (tp.tags || []).forEach(t => {
        const span = document.createElement('span');
        span.className = 'tag';
        span.textContent = t;
        span.title = 'Clique para remover tag';
        span.onclick = () => {
          tp.tags = tp.tags.filter(tag => tag !== t);
          salvarEstado();
          renderizarMapaMental();
        };
        el.appendChild(span);
      });

      // Bot√£o add tag
      const btnAddTag = document.createElement('button');
      btnAddTag.textContent = '+Tag';
      btnAddTag.onclick = e => {
        e.stopPropagation();
        const tNome = prompt('Nome da tag:');
        if(tNome && !tp.tags.includes(tNome.trim())) {
          tp.tags = tp.tags || [];
          tp.tags.push(tNome.trim());
          salvarEstado();
          renderizarMapaMental();
        }
      };
      el.appendChild(btnAddTag);

      // Bot√£o conectar (selecionar)
      const btnConectar = document.createElement('button');
      btnConectar.textContent = selecao.includes(tp.id) ? 'Selecionado' : 'Selecionar';
      btnConectar.className = 'conexaoBtn';
      btnConectar.onclick = () => {
        if(!selecao.includes(tp.id)){
          selecao.push(tp.id);
        } else {
          // apenas para visual, pode tirar
        }
        renderizarMapaMental();
      };
      el.appendChild(btnConectar);

      // Bot√£o remover conex√µes
      const btnRemCon = document.createElement('button');
      btnRemCon.textContent = 'Remover Conex√µes';
      btnRemCon.className = 'conexaoBtn';
      btnRemCon.onclick = () => {
        if(selecao.length >= 2) {
          selecao.forEach(id => {
            const t = mapaMental.find(t => t.id===id);
            if(t) {
              t.conexoes = t.conexoes.filter(c => !selecao.includes(c));
            }
          });
          salvarEstado();
          renderizarMapaMental();
        } else {
          toast('Selecione pelo menos dois t√≥picos');
        }
      };
      el.appendChild(btnRemCon);

      // Bot√£o excluir t√≥pico
      const btnExcluir = document.createElement('button');
      btnExcluir.textContent = 'Excluir';
      btnExcluir.onclick = () => {
        if(confirm('Excluir t√≥pico e conex√µes?')){
          // remove conex√µes
          mapaMental.forEach(t => {
            t.conexoes = t.conexoes.filter(c => c !== tp.id);
          });
          // remove t√≥pico
          mapaMental = mapaMental.filter(t => t.id !== tp.id);
          selecao = selecao.filter(id => id !== tp.id);
          salvarEstado();
          renderizarMapaMental();
        }
      };
      el.appendChild(btnExcluir);

      // Drag & drop t√≥picos
      el.onmousedown = e => {
        dragTopo = tp;
        const rect = document.getElementById('mapaContainer').getBoundingClientRect();
        offsetX = e.clientX - rect.left - tp.pos.x;
        offsetY = e.clientY - rect.top - tp.pos.y;
        e.stopPropagation();
        e.preventDefault();
      };

      container.appendChild(el);
    });

    // Desenhar conex√µes
    mapaMental.forEach(tp => {
      const fromX = tp.pos.x + 80;
      const fromY = tp.pos.y + 25;
      tp.conexoes.forEach(destId => {
        const dest = mapaMental.find(t => t.id===destId);
        if(dest){
          const toX = dest.pos.x + 80;
          const toY = dest.pos.y + 25;
          const path = document.createElementNS('http://www.w3.org/2000/svg','path');
          const midX = (fromX + toX)/2;
          const midY = (fromY + toY)/2 + (fromY < toY ? -50 : 50);
          path.setAttribute('d', `M${fromX},${fromY} L${midX},${midY} L${toX},${toY}`);
          path.setAttribute('stroke','#FFC107');
          path.setAttribute('stroke-width',2.5);
          svg.appendChild(path);
        }
      });
    });
  }

  // Eventos globais para arraste t√≥picos
  document.body.onmousemove = e => {
    if(dragTopo){
      const rect = document.getElementById('mapaContainer').getBoundingClientRect();
      let x = (e.clientX - rect.left - offsetX);
      let y = (e.clientY - rect.top - offsetY);
      // Limites
      x = Math.max(0, Math.min(rect.width - 160, x));
      y = Math.max(0, Math.min(rect.height - 50, y));
      dragTopo.pos.x = x;
      dragTopo.pos.y = y;
      salvarEstado();
      renderizarMapaMental();
    }
  };
  document.body.onmouseup = () => {
    dragTopo = null;
  };

  // Zoom e pan
  let zoomLevel = 1;
  let panX = 0;
  let panY = 0;
  let isPanning = false;
  let startPan = {x:0, y:0};
  let panStart = {x:0, y:0};

  document.getElementById('mapaContainer').addEventListener('wheel', e => {
    e.preventDefault();
    zoomLevel += -e.deltaY * 0.0015;
    zoomLevel = Math.min(Math.max(0.5, zoomLevel), 3);
    renderizarMapaMental();
  }, {passive: false});

  document.getElementById('mapaContainer').addEventListener('mousedown', e => {
    if(e.target.id === 'mapaContainer' || e.target.id==='svgConexoes'){
      isPanning = true;
      startPan.x = e.clientX;
      startPan.y = e.clientY;
      panStart.x = panX;
      panStart.y = panY;
      document.getElementById('mapaContainer').style.cursor='grabbing';
    }
  });
  document.body.addEventListener('mouseup', () => {
    isPanning = false;
    document.getElementById('mapaContainer').style.cursor='grab';
  });
  document.body.addEventListener('mousemove', e => {
    if(isPanning){
      panX = panStart.x + (e.clientX - startPan.x);
      panY = panStart.y + (e.clientY - startPan.y);
      document.getElementById('mapaMental').style.transform = `translate(${panX}px, ${panY}px) scale(${zoomLevel})`;
    }
  });

  // Sele√ß√£o m√∫ltipla
  function limparSelecao() {
    selecao = [];
    renderizarMapaMental();
    toast('Sele√ß√£o limpa');
  }

  function selecionarParaConectar() {
    toast('Clique nos t√≥picos para selecionar, depois Conectar');
  }

  function conectarSelecionados() {
    if(selecao.length<2){
      toast('Selecione pelo menos dois t√≥picos');
      return;
    }
    selecao.forEach(id1 => {
      const t1 = mapaMental.find(t => t.id===id1);
      selecao.forEach(id2 => {
        if(id1!==id2 && !t1.conexoes.includes(id2)){
          t1.conexoes.push(id2);
        }
      });
    });
    salvarEstado();
    limparSelecao();
    renderizarMapaMental();
  }

  // Exportar/Importar
  function exportarDados() {
    const dados = { colunas, mapaMental };
    const jsonStr = JSON.stringify(dados, null, 2);
    const blob = new Blob([jsonStr], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'fjnotes-dados.json';
    a.click();
    URL.revokeObjectURL(url);
    toast('Dados exportados');
  }

  function mostrarImportar() {
    document.getElementById('arquivoImportar').click();
  }

  function importarDados(e) {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const dados = JSON.parse(reader.result);
        colunas = dados.colunas || [];
        mapaMental = dados.mapaMental || [];
        salvarEstado();
        renderizarColunas();
        renderizarMapaMental();
        mostrarTabuleiro();
        toast('Dados importados');
      } catch {
        toast('Erro ao importar');
      }
    };
    reader.readAsText(file);
  }

  // Buscar
  function filtrarConteudo() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    // Colunas e cart√µes
    colunas.forEach(c => {
      const colDiv = [...document.querySelectorAll('#telaPrincipal > div')].find(d => +d.getAttribute('data-id')===c.id);
      if(!colDiv) return;
      const colMatch = c.nome.toLowerCase().includes(q);
      let hasCartoesVisiveis = false;
      colDiv.querySelectorAll('.cartao').forEach((el, i) => {
        const cart = c.cartoes[i];
        const txt = cart.texto.toLowerCase();
        const tags = (cart.tags||[]).join(',').toLowerCase();
        const visivel = txt.includes(q) || colMatch || tags.includes(q);
        el.style.display = visivel ? '' : 'none';
        if(visivel) hasCartoesVisiveis = true;
      });
      colDiv.style.display = (colMatch || hasCartoesVisiveis) ? '' : 'none';
    });
    // Mapas
    mapaMental.forEach(t => {
      const el = [...document.querySelectorAll('#mapaMental > div')].find(d=>+d.getAttribute('data-id')===t.id);
      if(!el) return;
      const txt = t.texto.toLowerCase();
      const tags = (t.tags||[]).join(',').toLowerCase();
      const visivel = txt.includes(q) || tags.includes(q);
      el.style.display = visivel ? '' : 'none';
    });
  }

  // Mostrar modos
  function mostrarTabuleiro() {
    modoMapa = false;
    document.getElementById('telaPrincipal').style.display='flex';
    document.getElementById('mapaContainer').style.display='none';
  }
  function mostrarMapaMental() {
    modoMapa = true;
    document.getElementById('telaPrincipal').style.display='none';
    document.getElementById('mapaContainer').style.display='block';
    renderizarMapaMental();
  }

  // Iniciar
  renderizarColunas();
  mostrarTabuleiro();
  salvarEstado();

</script>
</body>
</html>
